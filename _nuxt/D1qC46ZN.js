var me=Object.defineProperty;var pe=(i,n,c)=>n in i?me(i,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):i[n]=c;var X=(i,n,c)=>pe(i,typeof n!="symbol"?n+"":n,c);import{T as z,r as y,e as Z,n as ve,f as q,u as H,a5 as fe,c as b,o as p,W as D,a as e,b as l,M as ye,X as r,R,t as g,d as L,a3 as be,w as f,Y as xe}from"./B4E7ZWnt.js";import N from"./BxPwzCRT.js";import F from"./DwAdkREz.js";import Y from"./BllQzvUM.js";import ge from"./dWyEHhB1.js";import _e from"./CagCrEFU.js";import he from"./6oqjfP2G.js";import we from"./BhjLKwJF.js";import ke from"./CnrAg6u0.js";import{u as Se}from"./D30o-4Wj.js";import{_ as ee}from"./DlAUqK2U.js";import"./D3sxnxYH.js";import"./DW8g3rna.js";import"./TPlCE-Bg.js";import"./BQx4TB3x.js";import"./CV_ramxq.js";import"./DhdS97w-.js";import"./CpZQHmiY.js";import"./CXK9zG8y.js";import"./-wg2_ubr.js";import"./G_TuWFjL.js";import"./DstCPa0p.js";import"./DL5MBJTh.js";import"./gxi3oqc8.js";import"./Co5MXcSY.js";import"./BIOG6AuA.js";import"./09UQmLYI.js";import"./C7teFEHm.js";import"./lRlpCMFR.js";import"./DJNDGjeP.js";import"./Bga-6pQL.js";import"./BJY_LpcK.js";import"./BpzR12YL.js";import"./CyTa7YiO.js";import"./Dsj-KqYa.js";import"./8mk5V7sS.js";const Be=[{id:"prod_001",code:"8901030755009",productId:"prod_001",productName:"Paracetamol 500mg (10 Tablets)",price:25,stock:150,category:"Pain Relief",manufacturer:"GSK Pharma",batchNumber:"B12345",expiryDate:"2025-12-31"},{id:"prod_002",code:"8901030755016",productId:"prod_002",productName:"Cetirizine 10mg (10 Tablets)",price:35.5,stock:89,category:"Allergy",manufacturer:"Cipla",batchNumber:"C23456",expiryDate:"2025-10-15"},{id:"prod_003",code:"8901030755023",productId:"prod_003",productName:"Omeprazole 20mg (15 Capsules)",price:120,stock:42,category:"Acidity",manufacturer:"Sun Pharma",batchNumber:"O34567",expiryDate:"2025-11-30"}],U=()=>new Promise(i=>setTimeout(i,300+Math.random()*400));class De{constructor(){X(this,"products",Be)}async scanBarcode(n){return await U(),this.products.find(c=>c.code===n)||null}async getProductByBarcode(n){return this.scanBarcode(n)}async searchProducts(n){await U();const c=n.toLowerCase();return this.products.filter(u=>u.productName.toLowerCase().includes(c)||u.code.includes(n))}async updateStock(n,c,u="set"){await U();const o=this.products.find(m=>m.id===n);if(!o)return null;switch(u){case"add":o.stock+=c;break;case"subtract":o.stock=Math.max(0,o.stock-c);break;case"set":default:o.stock=c}return{...o}}}const J=new De,Ce=()=>{const i=z(),n=y(!1),c=y(null),u=y([]),o=y(null);return{isScanning:n,lastScanned:c,scanHistory:u,error:o,scanBarcode:async _=>{if(!_)return o.value="Barcode cannot be empty",i.add({severity:"error",summary:"Error",detail:"Barcode cannot be empty",life:3e3}),null;n.value=!0,o.value=null;try{const v=await J.scanBarcode(_);return v?(c.value=v,u.value.unshift(v),i.add({severity:"success",summary:"Scanned",detail:`Found: ${v.productName}`,life:3e3})):(o.value="Product not found",i.add({severity:"warn",summary:"Not Found",detail:"No product found for this barcode",life:3e3})),v}catch(v){return console.error("Barcode scan failed:",v),o.value="Failed to scan barcode",i.add({severity:"error",summary:"Error",detail:"Failed to scan barcode",life:3e3}),null}finally{n.value=!1}},searchProducts:async _=>{if(!_)return[];n.value=!0,o.value=null;try{return await J.searchProducts(_)}catch(v){return console.error("Product search failed:",v),o.value="Failed to search products",i.add({severity:"error",summary:"Error",detail:"Failed to search products",life:3e3}),[]}finally{n.value=!1}},clearLastScanned:()=>{c.value=null},clearHistory:()=>{u.value=[]}}},Ne={class:"barcode-scanner"},Pe={key:0,class:"demo-banner p-2 mb-4 text-center",style:{"background-color":"var(--primary-100)","border-radius":"4px"}},Ie={class:"scanner-controls"},$e={key:1,class:"camera-container"},Ee={key:0,class:"scanner-overlay"},Te={class:"text-center"},Me={class:"text-900 font-bold"},Fe={class:"mt-2"},He={key:0,class:"mt-1 text-sm text-600"},Re={key:2,class:"manual-input"},Ae={class:"p-fluid"},Oe={class:"field"},Ve=Z({__name:"BarcodeScanner",props:{autoFocus:{type:Boolean,default:!1},demoMode:{type:Boolean,default:!1},autoSubmit:{type:Boolean,default:!1}},emits:["scan","error"],setup(i,{expose:n,emit:c}){const u=i,o=c,m=y(null),I=y(null),w=y(null),k=y(""),_=y(!1),v=y(!1),S=y(!0),$=y(null),{scanBarcode:A,isScanning:h,lastScanned:x,scanHistory:M,clearHistory:d,error:s}=Ce(),{useInventory:te}=Se(),{getByBarcode:oe}=te(),O=y(null),se=async()=>{h.value?E():await W()},W=async()=>{if(S.value||(S.value=!0,await H()),v.value){setTimeout(async()=>{const t=await ce(k.value);t&&t.code?j(t.code):s.value="No result found"},1e3);return}try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});m.value&&(m.value.srcObject=t,$.value=t,await new Promise(a=>{m.value&&(m.value.onloadedmetadata=()=>a())}),V())}catch(t){console.error("Error accessing camera:",t),z().add({severity:"error",summary:"Camera Error",detail:"Could not access the camera. Please check your permissions.",life:5e3}),E()}},E=()=>{$.value&&($.value.getTracks().forEach(t=>t.stop()),$.value=null),m.value&&(m.value.srcObject=null)},V=async()=>{if(!m.value||!I.value)return;const t=I.value,a=t.getContext("2d");if(a){t.width=m.value.videoWidth,t.height=m.value.videoHeight,a.drawImage(m.value,0,0,t.width,t.height);try{if("BarcodeDetector"in window){const T=await new window.BarcodeDetector({formats:["ean_13","ean_8","upc_a","upc_e","code_128"]}).detect(t);if(T.length>0){const B=T[0].rawValue;await j(B);return}}h.value&&requestAnimationFrame(V)}catch(C){console.error("Barcode detection error:",C),h.value&&requestAnimationFrame(V)}}},j=async t=>{if(!t)return null;try{const a=await A(t);return a&&(o("scan",a),u.autoSubmit&&E()),a}catch(a){return console.error("Error scanning barcode:",a),o("error",a),null}},K=async()=>{k.value.trim()&&(await j(k.value),k.value="",w.value&&w.value.focus())},ae=()=>{E(),S.value=!S.value,!S.value&&w.value&&H(()=>{var t;return(t=w.value)==null?void 0:t.focus()})},re=t=>{x.value=t,_.value=!1,o("scan",t)},G=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(t),ne=t=>new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),le=t=>{const a=new Date,T=new Date(t).getTime()-a.getTime(),B=Math.ceil(T/(1e3*60*60*24));return B<0?"text-red-500 font-semibold":B<=30?"text-orange-500 font-semibold":"text-green-500"};async function ce(t){try{return s.value=null,O.value=await oe(t),O.value}catch(a){return s.value=a instanceof Error?a.message:String(a),O.value=null,null}}const ie=t=>t instanceof Error||typeof t=="object"&&t!==null&&"message"in t&&typeof t.message=="string";ve(s,t=>{if(t){const a=ie(t)?t:new Error(String(t));o("error",a)}}),q(()=>{v.value=u.demoMode,u.autoFocus&&w.value&&H(()=>{var t;return(t=w.value)==null?void 0:t.focus()}),document.addEventListener("keydown",Q)}),fe(()=>{E(),document.removeEventListener("keydown",Q)});const Q=t=>{S.value||t.ctrlKey||t.altKey||t.metaKey||t.key==="Enter"&&k.value.trim()&&(t.preventDefault(),K())};return n({startScanning:W,stopScanning:E,clearHistory:d,focus:()=>{var t;return(t=w.value)==null?void 0:t.focus()},clear:()=>{k.value=""}}),(t,a)=>{const C=N,T=_e,B=he,de=we,ue=ke;return p(),b("div",Ne,[v.value?(p(),b("div",Pe,a[3]||(a[3]=[e("i",{class:"pi pi-info-circle mr-2"},null,-1),e("span",null,"Demo Mode: Using static mock data",-1)]))):D("",!0),e("div",Ie,[l(C,{label:r(h)?"Stop Scanning":"Start Scanning",icon:r(h)?"pi pi-stop":"pi pi-camera",onClick:se,class:"p-button-rounded p-button-text",loading:r(h)},null,8,["label","icon","loading"]),r(M).length>0?(p(),ye(C,{key:0,icon:"pi pi-history",label:`History (${r(M).length})`,onClick:a[0]||(a[0]=P=>_.value=!0),class:"p-button-rounded p-button-text"},null,8,["label"])):D("",!0),l(C,{icon:"pi pi-keyboard",label:S.value?"Manual Entry":"Use Camera",onClick:ae,class:"p-button-rounded p-button-text"},null,8,["label"])]),S.value?(p(),b("div",$e,[e("video",{ref_key:"videoRef",ref:m,class:R(["camera-preview",{"d-none":!r(h)}]),autoplay:"",playsinline:""},null,2),e("canvas",{ref_key:"canvasRef",ref:I,class:"d-none"},null,512),r(h)?(p(),b("div",Ee,a[4]||(a[4]=[e("div",{class:"scanner-frame"},null,-1)]))):D("",!0),r(x)?(p(),b("div",{key:1,class:R(["scan-result p-4 mt-4 border-round",{"bg-green-50":r(x)}])},[e("div",Te,[e("div",Me,"Scanned: "+g(r(x).productName),1),e("div",Fe,[a[5]||(a[5]=e("span",{class:"font-semibold"},"Price:",-1)),L(" "+g(G(r(x).price))+" ",1),a[6]||(a[6]=e("span",{class:"mx-2"},"|",-1)),a[7]||(a[7]=e("span",{class:"font-semibold"},"Stock:",-1)),L(" "+g(r(x).stock),1)]),r(x).category?(p(),b("div",He,g(r(x).manufacturer)+" â€¢ "+g(r(x).category),1)):D("",!0),r(x).expiryDate?(p(),b("div",{key:1,class:R(["mt-1 text-sm",le(r(x).expiryDate)])}," Expires: "+g(ne(r(x).expiryDate)),3)):D("",!0)])],2)):D("",!0)])):(p(),b("div",Re,[e("div",Ae,[e("div",Oe,[a[8]||(a[8]=e("label",{for:"barcode"},"Enter Barcode",-1)),l(T,{id:"barcode",modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=P=>k.value=P),placeholder:"Scan or enter barcode",onKeyup:be(K,["enter"]),disabled:r(h),ref_key:"barcodeInputRef",ref:w},null,8,["modelValue","disabled"])]),l(C,{label:"Submit",icon:"pi pi-check",onClick:K,loading:r(h),class:"mt-2 w-full"},null,8,["loading"])])])),l(ue,{visible:_.value,"onUpdate:visible":a[2]||(a[2]=P=>_.value=P),header:"Scan History",style:{width:"90vw",maxWidth:"800px"},modal:!0},{default:f(()=>[l(de,{value:r(M),rows:10,paginator:!0,rowHover:!0,scrollable:!0,scrollHeight:"400px",class:"p-datatable-sm"},{default:f(()=>[l(B,{field:"barcode",header:"Barcode",sortable:!0}),l(B,{field:"productName",header:"Product",sortable:!0}),l(B,{field:"price",header:"Price",sortable:!0},{body:f(({data:P})=>[L(g(G(P.price)),1)]),_:1}),l(B,{field:"stock",header:"Stock",sortable:!0}),l(B,{header:"Actions",style:{width:"100px"}},{body:f(({data:P})=>[l(C,{icon:"pi pi-eye",class:"p-button-text p-button-sm",onClick:xt=>re(P)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])]),_:1},8,["visible"])])}}}),je=ee(Ve,[["__scopeId","data-v-8a544b21"]]),Ke={class:"p-4"},Le={class:"flex justify-content-between align-items-center mb-6"},Ue={class:"grid"},ze={class:"col-12 lg:col-8"},We={class:"flex flex-column align-items-center"},Ge={class:"flex flex-wrap gap-3 justify-content-center"},Qe={class:"grid"},Xe={class:"col-12 md:col-6 lg:col-4"},Ye={class:"col-12 md:col-6 lg:col-4"},Je={class:"col-12 md:col-6 lg:col-4"},Ze={class:"col-12 lg:col-4"},qe={key:0,class:"scanned-product"},et={class:"flex justify-content-between align-items-center mb-4"},tt={class:"text-900 font-bold text-xl"},ot={class:"grid"},st={class:"col-6"},at={class:"font-medium"},rt={class:"col-6"},nt={class:"font-medium"},lt={key:0,class:"col-6"},ct={class:"font-medium"},it={key:1,class:"col-6"},dt={class:"font-medium"},ut={key:2,class:"col-6"},mt={class:"font-medium"},pt={key:3,class:"col-6"},vt={class:"font-medium"},ft={class:"flex flex-wrap gap-3 mt-4"},yt={key:1,class:"text-center p-4"},bt=Z({__name:"scan",setup(i){const n=xe(),c=z(),u=y(),o=y(null),m=()=>{n.push("/inventory/products")},I=()=>{n.push("/inventory/products")},w=()=>{n.push("/inventory/search")},k=()=>{n.push("/inventory")},_=()=>{n.push("/pos")},v=d=>{o.value=d,c.add({severity:"success",summary:"Barcode Scanned",detail:`Successfully scanned ${d.productName}`,life:3e3})},S=d=>{c.add({severity:"error",summary:"Scan Error",detail:d.message,life:5e3})},$=()=>{o.value&&n.push(`/inventory/products/${o.value.productId}`)},A=()=>{o.value&&n.push({path:"/inventory/adjust-stock",query:{productId:o.value.productId}})},h=d=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(d),x=d=>new Date(d).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),M=d=>d<=0?"bg-red-100 text-red-800":d<=10?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800";return q(()=>{u.value&&H(()=>{var d;(d=u.value)==null||d.focus()})}),(d,s)=>(p(),b("div",Ke,[e("div",Le,[s[0]||(s[0]=e("div",null,[e("h1",{class:"text-3xl font-bold text-900 m-0"},"Barcode Scanner"),e("p",{class:"text-600 m-0 mt-2"},"Scan barcodes to view product information")],-1)),l(r(N),{label:"View All Products",icon:"pi pi-list",class:"p-button-outlined p-button-sm",onClick:m})]),e("div",Ue,[e("div",ze,[l(r(F),{class:"mb-6"},{title:f(()=>s[1]||(s[1]=[e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-barcode text-2xl mr-3"}),e("span",null,"Scan Barcode")],-1)])),content:f(()=>[e("div",We,[l(je,{ref_key:"barcodeScanner",ref:u,onScan:v,onError:S,class:"w-full"},null,512),l(r(Y),{align:"center",type:"dashed",class:"my-6 w-full"},{default:f(()=>s[2]||(s[2]=[e("span",{class:"text-600 font-medium"},"OR",-1)])),_:1,__:[2]}),e("div",Ge,[l(r(N),{label:"Search Product",icon:"pi pi-search",class:"p-button-outlined",onClick:w}),l(r(N),{label:"Add New Product",icon:"pi pi-plus",class:"p-button-outlined",onClick:I})])])]),_:1}),e("div",Qe,[e("div",Xe,[l(r(F),{class:"h-full"},{title:f(()=>s[3]||(s[3]=[e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-plus-circle text-xl mr-2"}),e("span",null,"Quick Add")],-1)])),content:f(()=>[s[4]||(s[4]=e("p",{class:"text-600 mb-4"},"Add a new product to your inventory",-1)),l(r(N),{label:"Add Product",icon:"pi pi-plus",class:"p-button-outlined w-full",onClick:I})]),_:1})]),e("div",Ye,[l(r(F),{class:"h-full"},{title:f(()=>s[5]||(s[5]=[e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-tags text-xl mr-2"}),e("span",null,"Inventory")],-1)])),content:f(()=>[s[6]||(s[6]=e("p",{class:"text-600 mb-4"},"Manage your inventory items and stock levels",-1)),l(r(N),{label:"View Inventory",icon:"pi pi-box",class:"p-button-outlined w-full",onClick:k})]),_:1})]),e("div",Je,[l(r(F),{class:"h-full"},{title:f(()=>s[7]||(s[7]=[e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-shopping-cart text-xl mr-2"}),e("span",null,"POS")],-1)])),content:f(()=>[s[8]||(s[8]=e("p",{class:"text-600 mb-4"},"Process sales and manage transactions",-1)),l(r(N),{label:"Open POS",icon:"pi pi-credit-card",class:"p-button-outlined w-full",onClick:_})]),_:1})])])]),e("div",Ze,[l(r(F),{class:"sticky top-4"},{title:f(()=>s[9]||(s[9]=[e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-tag text-2xl mr-3"}),e("span",null,"Scanned Product")],-1)])),content:f(()=>[o.value?(p(),b("div",qe,[e("div",et,[e("div",tt,g(o.value.productName),1),l(r(ge),{label:`In Stock: ${o.value.stock}`,class:R(M(o.value.stock))},null,8,["label","class"])]),e("div",ot,[e("div",st,[s[10]||(s[10]=e("div",{class:"text-600 text-sm mb-1"},"Barcode",-1)),e("div",at,g(o.value.code),1)]),e("div",rt,[s[11]||(s[11]=e("div",{class:"text-600 text-sm mb-1"},"Price",-1)),e("div",nt,g(h(o.value.price)),1)]),o.value.category?(p(),b("div",lt,[s[12]||(s[12]=e("div",{class:"text-600 text-sm mb-1"},"Category",-1)),e("div",ct,g(o.value.category),1)])):D("",!0),o.value.manufacturer?(p(),b("div",it,[s[13]||(s[13]=e("div",{class:"text-600 text-sm mb-1"},"Manufacturer",-1)),e("div",dt,g(o.value.manufacturer),1)])):D("",!0),o.value.batchNumber?(p(),b("div",ut,[s[14]||(s[14]=e("div",{class:"text-600 text-sm mb-1"},"Batch No.",-1)),e("div",mt,g(o.value.batchNumber),1)])):D("",!0),o.value.expiryDate?(p(),b("div",pt,[s[15]||(s[15]=e("div",{class:"text-600 text-sm mb-1"},"Expiry Date",-1)),e("div",vt,g(x(o.value.expiryDate)),1)])):D("",!0)]),l(r(Y),{class:"my-4"}),e("div",ft,[l(r(N),{label:"View Details",icon:"pi pi-eye",class:"p-button-outlined flex-1",onClick:$}),l(r(N),{label:"Adjust Stock",icon:"pi pi-box",class:"p-button-outlined flex-1",onClick:A})])])):(p(),b("div",yt,s[16]||(s[16]=[e("i",{class:"pi pi-inbox text-5xl text-400 mb-3"},null,-1),e("p",{class:"text-600 mb-4"},"No product scanned yet",-1),e("p",{class:"text-sm text-500"},"Scan a barcode or search for a product to see details here",-1)])))]),_:1})])])]))}}),oo=ee(bt,[["__scopeId","data-v-3a35ea05"]]);export{oo as default};

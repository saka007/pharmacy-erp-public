import ke from"./B_BSdajj.js";import Te from"./DMrRDVbe.js";import{T as me,r as y,j as M,n as ie,M as K,o as S,w as r,a as e,c as X,W as le,b as l,t as n,U as Ce,V as se,d as Ee,f as Ne,R as Be,O as Fe,Q as Le}from"./C75sWQ17.js";import{u as ge}from"./CS_gL7I1.js";import ve from"./M2-fOS9N.js";import pe from"./BiIHwpDv.js";import Ie from"./Dv734B7a.js";import he from"./PugWiiXg.js";import _e from"./DrrBm_tI.js";import Me from"./DgyfLFB-.js";import we from"./DBRuJf76.js";import je from"./BT7qUuys.js";import ze from"./lT0wVcxz.js";import De from"./C3XBHxYa.js";import fe from"./DB-7dZs6.js";import Ve from"./BEk77WGX.js";import He from"./hXjzZJ_3.js";import Ge from"./CT9-M-Jt.js";import{_ as ne}from"./DlAUqK2U.js";import We from"./CtWPRs3h.js";import"./Bp30Rkwz.js";import"./DnWt4iB7.js";import"./a3IUqZJ6.js";import"./C6o1UzvO.js";import"./BLBtN7Vw.js";import"./Kwvy9bwp.js";import"./CLKZ7GqN.js";import"./DYFHDyQ0.js";import"./hZldab_6.js";import"./7s5qCgTI.js";import"./Du1f6vVH.js";import"./D-dmaqJg.js";import"./GojKZ2PW.js";import"./kW09eZOd.js";import"./CwqodYyw.js";import"./DaJP8EvY.js";import"./RTEWMrHx.js";import"./Dv5mX8ha.js";import"./DyoQBExO.js";import"./DiRvyYBK.js";import"./Dyb13Abn.js";import"./BImoKj12.js";import"./BQcC7MIq.js";import"./DLeBtkWy.js";import"./v7U6BRNz.js";const Ye={class:"grid p-fluid"},Je={class:"col-12"},Ke={class:"field"},Xe={class:"flex align-items-center"},Ze={class:"flex-1"},et={class:"font-semibold"},tt={class:"text-sm text-600"},lt={class:"text-sm text-600"},st={class:"text-right"},ot={class:"font-semibold"},at={class:"text-sm text-600"},it={key:0,class:"col-12"},nt={class:"field"},dt={class:"col-12 md:col-6"},rt={class:"field"},ut={class:"col-12 md:col-6"},ct={class:"field"},mt={class:"col-12"},vt={class:"field"},pt={class:"bg-gray-50 p-3 border-round"},ft={class:"text-lg font-semibold text-primary"},bt={class:"col-12"},yt={class:"flex align-items-center"},xt={class:"flex justify-content-end gap-2"},gt={__name:"AddItemDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","item-added"],setup(V,{emit:j}){const g=V,F=j,T=me(),{useProducts:E}=ge(),{fetchProducts:P}=E(),p=y(!1),D=y(!1),C=y(!1),N=y(null),A=y([]),h=y({productId:"",productName:"",quantity:1,unitPrice:0}),$=M(()=>(h.value.quantity||0)*(h.value.unitPrice||0)),f=M(()=>C.value?h.value.productName&&h.value.quantity>0&&h.value.unitPrice>0:N.value&&h.value.quantity>0&&h.value.unitPrice>0);ie(()=>g.visible,d=>{d&&I()}),ie(N,d=>{d&&(h.value.productId=d.id,h.value.productName=d.name,h.value.unitPrice=d.purchasePrice||0,C.value=!1)});const I=()=>{N.value=null,C.value=!1,h.value={productId:"",productName:"",quantity:1,unitPrice:0},A.value=[]},R=async d=>{try{D.value=!0;const i=await P({search:d.query,limit:10});A.value=i.data||[]}catch(i){console.error("Error searching products:",i),A.value=[]}finally{D.value=!1}},B=d=>{N.value=d.value},W=()=>{},Q=async()=>{try{p.value=!0;const d={productId:h.value.productId||`manual_${Date.now()}`,productName:h.value.productName,quantity:h.value.quantity,unitPrice:h.value.unitPrice,totalPrice:$.value};F("item-added",d),m()}catch{T.add({severity:"error",summary:"Error",detail:"Failed to add item",life:5e3})}finally{p.value=!1}},m=()=>{I(),F("update:visible",!1)},s=d=>new Intl.NumberFormat("en-IN").format(d||0);return(d,i)=>{const z=He,U=pe,H=Ve,x=Ge,u=ve,Z=fe;return S(),K(Z,{visible:V.visible,modal:"",header:"Add Item to Purchase Order",style:{width:"600px"},breakpoints:{"960px":"75vw","641px":"90vw"},"onUpdate:visible":i[5]||(i[5]=O=>d.$emit("update:visible",O)),onHide:m},{footer:r(()=>[e("div",xt,[l(u,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:m}),l(u,{label:"Add Item",icon:"pi pi-check",disabled:!f.value,loading:p.value,onClick:Q},null,8,["disabled","loading"])])]),default:r(()=>[e("div",Ye,[e("div",Je,[e("div",Ke,[i[6]||(i[6]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Product *",-1)),l(z,{modelValue:N.value,"onUpdate:modelValue":i[0]||(i[0]=O=>N.value=O),suggestions:A.value,onComplete:R,onItemSelect:B,field:"name",placeholder:"Search and select product...",class:"w-full",loading:D.value},{item:r(({item:O})=>[e("div",Xe,[e("div",Ze,[e("div",et,n(O.name),1),e("div",tt,n(O.sku)+" | "+n(O.category),1),e("div",lt,"Current Stock: "+n(O.currentStock||0),1)]),e("div",st,[e("div",ot,"â‚¹"+n(s(O.purchasePrice||0)),1),e("div",at,"per "+n(O.unit||"unit"),1)])])]),_:1},8,["modelValue","suggestions","loading"])])]),C.value?(S(),X("div",it,[i[8]||(i[8]=e("div",{class:"bg-yellow-50 border-yellow-200 border-1 border-round p-3 mb-3"},[e("div",{class:"flex align-items-center"},[e("i",{class:"pi pi-exclamation-triangle text-yellow-600 mr-2"}),e("span",{class:"text-sm"},"Product not found? Enter details manually")])],-1)),e("div",nt,[i[7]||(i[7]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Product Name *",-1)),l(U,{modelValue:h.value.productName,"onUpdate:modelValue":i[1]||(i[1]=O=>h.value.productName=O),placeholder:"Enter product name",class:"w-full"},null,8,["modelValue"])])])):le("",!0),e("div",dt,[e("div",rt,[i[9]||(i[9]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Quantity *",-1)),l(H,{modelValue:h.value.quantity,"onUpdate:modelValue":i[2]||(i[2]=O=>h.value.quantity=O),min:1,placeholder:"Enter quantity",class:"w-full",onInput:W},null,8,["modelValue"])])]),e("div",ut,[e("div",ct,[i[10]||(i[10]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Unit Price *",-1)),l(H,{modelValue:h.value.unitPrice,"onUpdate:modelValue":i[3]||(i[3]=O=>h.value.unitPrice=O),mode:"currency",currency:"INR",locale:"en-IN",min:0,placeholder:"Enter unit price",class:"w-full",onInput:W},null,8,["modelValue"])])]),e("div",mt,[e("div",vt,[i[11]||(i[11]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Total Price",-1)),e("div",pt,[e("span",ft," â‚¹"+n(s($.value)),1)])])]),e("div",bt,[e("div",yt,[l(x,{modelValue:C.value,"onUpdate:modelValue":i[4]||(i[4]=O=>C.value=O),inputId:"manual-entry",binary:""},null,8,["modelValue"]),i[12]||(i[12]=e("label",{for:"manual-entry",class:"ml-2 text-sm"}," Enter product details manually ",-1))])])])]),_:1},8,["visible"])}}},ht=ne(gt,[["__scopeId","data-v-b6188579"]]),_t={key:0,class:"purchase-order-details"},wt={class:"grid mb-4"},Dt={class:"col-12 md:col-6"},Vt={class:"field"},$t={class:"col-12 md:col-6"},Pt={class:"field"},Ot={class:"col-12 md:col-6"},kt={class:"field"},Ct={class:"col-12 md:col-6"},Nt={class:"field"},It={class:"col-12"},St={class:"field"},Ut={class:"items-section"},Rt={class:"flex justify-content-between align-items-center mb-3"},At={class:"flex justify-content-between align-items-center"},Qt={class:"text-sm font-medium"},qt={key:0,class:"flex gap-2"},Tt={class:"font-semibold"},Et={class:"text-sm text-600"},Bt={key:1,class:"font-medium"},Ft={key:1,class:"font-medium"},Lt={class:"font-semibold"},Mt={class:"font-medium"},jt={class:"font-medium text-orange-600"},zt={class:"text-center py-4"},Ht={class:"mt-4 flex justify-content-end"},Gt={class:"bg-gray-50 p-3 border-round"},Wt={class:"grid text-right"},Yt={class:"col-6 font-semibold"},Jt={class:"col-6 text-600"},Kt={class:"col-6 font-semibold"},Xt={class:"col-6 font-bold text-lg text-primary"},Zt={class:"flex justify-content-between"},el={class:"flex gap-2"},tl={__name:"PurchaseOrderDetails",props:{visible:{type:Boolean,default:!1},purchaseOrder:{type:Object,default:null},vendors:{type:Array,default:()=>[]},mode:{type:String,default:"view"}},emits:["update:visible","save","print"],setup(V,{emit:j}){const g=V,F=j,T=me(),E=y(!1),P=y(!1),p=y(!1),D=y(!1),C=y(),N=y(null),A=y(18),h=y([{label:"Draft",value:"draft"},{label:"Pending",value:"pending"},{label:"Partial",value:"partial"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}]),$=M(()=>g.purchaseOrder?`${g.purchaseOrder.poNumber} - ${p.value?"Edit":"View"} Details`:"Purchase Order Details"),f=M(()=>{var x;return(x=g.purchaseOrder)!=null&&x.items?g.purchaseOrder.items.reduce((u,Z)=>u+(Z.totalPrice||0),0):0}),I=M(()=>f.value*A.value/100),R=M(()=>f.value+I.value);ie(()=>g.visible,x=>{x&&g.purchaseOrder&&B()}),ie(()=>g.mode,x=>{p.value=x==="edit"});const B=()=>{var x;p.value=g.mode==="edit",(x=g.purchaseOrder)!=null&&x.expectedDelivery&&(N.value=new Date(g.purchaseOrder.expectedDelivery))},W=()=>{p.value=!0},Q=x=>{x.totalPrice=(x.quantity||0)*(x.unitPrice||0),x.remainingQuantity=(x.quantity||0)-(x.receivedQuantity||0)},m=x=>{g.purchaseOrder.items||(g.purchaseOrder.items=[]);const u={...x,id:`item_${Date.now()}`,totalPrice:x.quantity*x.unitPrice,receivedQuantity:0,remainingQuantity:x.quantity};g.purchaseOrder.items.push(u),D.value=!1,T.add({severity:"success",summary:"Item Added",detail:`${x.productName} added to purchase order`,life:3e3})},s=x=>{g.purchaseOrder.items.splice(x,1),T.add({severity:"info",summary:"Item Removed",detail:"Item removed from purchase order",life:3e3})},d=async()=>{try{P.value=!0,N.value&&(g.purchaseOrder.expectedDelivery=N.value.toISOString().split("T")[0]),g.purchaseOrder.subtotal=f.value,g.purchaseOrder.taxAmount=I.value,g.purchaseOrder.totalAmount=R.value,g.purchaseOrder.updatedAt=new Date().toISOString(),F("save",g.purchaseOrder),p.value=!1,T.add({severity:"success",summary:"Changes Saved",detail:"Purchase order updated successfully",life:3e3})}catch{T.add({severity:"error",summary:"Save Failed",detail:"Failed to save changes",life:5e3})}finally{P.value=!1}},i=()=>{C.value&&(C.value.exportCSV(),T.add({severity:"success",summary:"Export Complete",detail:"Items exported to CSV",life:3e3}))},z=()=>{F("print",g.purchaseOrder)},U=()=>{p.value=!1,D.value=!1,F("update:visible",!1)},H=x=>new Intl.NumberFormat("en-IN").format(x||0);return(x,u)=>{const Z=pe,O=Ie,b=he,G=De,L=ve,Y=_e,de=Ve,be=we,ye=fe,oe=Ce("tooltip");return S(),K(ye,{visible:V.visible,modal:"",header:$.value,style:{width:"90vw",maxWidth:"1200px"},breakpoints:{"960px":"95vw"},"onUpdate:visible":u[8]||(u[8]=v=>x.$emit("update:visible",v)),onHide:U},{footer:r(()=>{var v;return[e("div",Zt,[e("div",null,[!p.value&&((v=V.purchaseOrder)==null?void 0:v.status)!=="completed"?(S(),K(L,{key:0,label:"Edit",icon:"pi pi-pencil",class:"p-button-outlined",onClick:W})):le("",!0)]),e("div",el,[l(L,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:U}),p.value?(S(),K(L,{key:0,label:"Save Changes",icon:"pi pi-check",loading:P.value,onClick:d},null,8,["loading"])):(S(),K(L,{key:1,label:"Print PO",icon:"pi pi-print",class:"p-button-outlined",onClick:z}))])])]}),default:r(()=>[V.purchaseOrder?(S(),X("div",_t,[e("div",wt,[e("div",Dt,[e("div",Vt,[u[9]||(u[9]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"PO Number",-1)),l(Z,{modelValue:V.purchaseOrder.poNumber,"onUpdate:modelValue":u[0]||(u[0]=v=>V.purchaseOrder.poNumber=v),disabled:!p.value,class:"w-full"},null,8,["modelValue","disabled"])])]),e("div",$t,[e("div",Pt,[u[10]||(u[10]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Status",-1)),l(O,{modelValue:V.purchaseOrder.status,"onUpdate:modelValue":u[1]||(u[1]=v=>V.purchaseOrder.status=v),options:h.value,"option-label":"label","option-value":"value",disabled:!p.value,class:"w-full"},null,8,["modelValue","options","disabled"])])]),e("div",Ot,[e("div",kt,[u[11]||(u[11]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Vendor",-1)),l(O,{modelValue:V.purchaseOrder.vendorId,"onUpdate:modelValue":u[2]||(u[2]=v=>V.purchaseOrder.vendorId=v),options:V.vendors,"option-label":"name","option-value":"id",disabled:!p.value,class:"w-full"},null,8,["modelValue","options","disabled"])])]),e("div",Ct,[e("div",Nt,[u[12]||(u[12]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Expected Delivery",-1)),l(b,{modelValue:N.value,"onUpdate:modelValue":u[3]||(u[3]=v=>N.value=v),disabled:!p.value,class:"w-full"},null,8,["modelValue","disabled"])])]),e("div",It,[e("div",St,[u[13]||(u[13]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Notes",-1)),l(G,{modelValue:V.purchaseOrder.notes,"onUpdate:modelValue":u[4]||(u[4]=v=>V.purchaseOrder.notes=v),disabled:!p.value,rows:"3",class:"w-full"},null,8,["modelValue","disabled"])])])]),e("div",Ut,[e("div",Rt,[u[14]||(u[14]=e("h3",{class:"text-lg font-semibold text-900 m-0"},"Purchase Items",-1)),p.value?(S(),K(L,{key:0,label:"Add Item",icon:"pi pi-plus",size:"small",onClick:u[5]||(u[5]=v=>D.value=!0)})):le("",!0)]),l(be,{ref_key:"itemsTable",ref:C,value:V.purchaseOrder.items,loading:E.value,responsiveLayout:"scroll",class:"border-1 border-200"},{header:r(()=>{var v;return[e("div",At,[e("span",Qt,"Items ("+n(((v=V.purchaseOrder.items)==null?void 0:v.length)||0)+")",1),p.value?(S(),X("div",qt,[se(l(L,{icon:"pi pi-file-excel",class:"p-button-success p-button-sm",onClick:i},null,512),[[oe,"Export Items",void 0,{top:!0}]])])):le("",!0)])]}),empty:r(()=>[e("div",zt,[u[15]||(u[15]=e("i",{class:"pi pi-shopping-cart text-4xl text-gray-300 mb-3"},null,-1)),u[16]||(u[16]=e("p",{class:"text-gray-500"},"No items added to this purchase order",-1)),p.value?(S(),K(L,{key:0,label:"Add First Item",icon:"pi pi-plus",class:"p-button-outlined",onClick:u[6]||(u[6]=v=>D.value=!0)})):le("",!0)])]),default:r(()=>[l(Y,{field:"productName",header:"Product",style:{"min-width":"200px"}},{body:r(({data:v})=>[e("div",Tt,n(v.productName),1),e("div",Et,"ID: "+n(v.productId),1)]),_:1}),l(Y,{field:"quantity",header:"Ordered Qty",style:{"min-width":"120px"}},{body:r(({data:v})=>[p.value?(S(),K(de,{key:0,modelValue:v.quantity,"onUpdate:modelValue":te=>v.quantity=te,min:1,class:"w-full",onInput:te=>Q(v)},null,8,["modelValue","onUpdate:modelValue","onInput"])):(S(),X("span",Bt,n(v.quantity),1))]),_:1}),l(Y,{field:"unitPrice",header:"Unit Price",style:{"min-width":"120px"}},{body:r(({data:v})=>[p.value?(S(),K(de,{key:0,modelValue:v.unitPrice,"onUpdate:modelValue":te=>v.unitPrice=te,mode:"currency",currency:"INR",locale:"en-IN",min:0,class:"w-full",onInput:te=>Q(v)},null,8,["modelValue","onUpdate:modelValue","onInput"])):(S(),X("span",Ft,"â‚¹"+n(H(v.unitPrice)),1))]),_:1}),l(Y,{field:"totalPrice",header:"Total",style:{"min-width":"120px"}},{body:r(({data:v})=>[e("span",Lt,"â‚¹"+n(H(v.totalPrice)),1)]),_:1}),l(Y,{field:"receivedQuantity",header:"Received",style:{"min-width":"100px"}},{body:r(({data:v})=>[e("span",Mt,n(v.receivedQuantity||0),1)]),_:1}),l(Y,{field:"remainingQuantity",header:"Pending",style:{"min-width":"100px"}},{body:r(({data:v})=>[e("span",jt,n(v.remainingQuantity||v.quantity),1)]),_:1}),p.value?(S(),K(Y,{key:0,header:"Actions",style:{"min-width":"100px"}},{body:r(({data:v,index:te})=>[se(l(L,{icon:"pi pi-trash",class:"p-button-danger p-button-text p-button-sm",onClick:$e=>s(te)},null,8,["onClick"]),[[oe,"Remove Item",void 0,{top:!0}]])]),_:1})):le("",!0)]),_:1},8,["value","loading"]),e("div",Ht,[e("div",Gt,[e("div",Wt,[u[17]||(u[17]=e("div",{class:"col-6 text-600"},"Subtotal:",-1)),e("div",Yt,"â‚¹"+n(H(f.value)),1),e("div",Jt,"Tax ("+n(A.value)+"%):",1),e("div",Kt,"â‚¹"+n(H(I.value)),1),u[18]||(u[18]=e("div",{class:"col-6 text-600 text-lg"},"Total:",-1)),e("div",Xt,"â‚¹"+n(H(R.value)),1)])])])])])):le("",!0),l(ht,{visible:D.value,"onUpdate:visible":u[7]||(u[7]=v=>D.value=v),onItemAdded:m},null,8,["visible"])]),_:1},8,["visible","header"])}}},ll=ne(tl,[["__scopeId","data-v-3d00ed4e"]]),sl={key:0,class:"purchase-receiving"},ol={class:"bg-blue-50 border-blue-200 border-1 border-round p-3 mb-4"},al={class:"grid"},il={class:"col-12 md:col-6"},nl={class:"font-semibold text-900"},dl={class:"col-12 md:col-6"},rl={class:"font-semibold text-900"},ul={class:"col-12 md:col-6"},cl={class:"font-semibold text-900"},ml={class:"col-12 md:col-6"},vl={class:"font-semibold text-900"},pl={class:"grid mb-4"},fl={class:"col-12 md:col-6"},bl={class:"field"},yl={class:"col-12 md:col-6"},xl={class:"field"},gl={class:"col-12"},hl={class:"field"},_l={class:"items-section"},wl={class:"font-semibold"},Dl={class:"text-sm text-600"},Vl={class:"font-medium"},$l={class:"font-medium text-green-600"},Pl={class:"font-medium text-orange-600"},Ol={class:"font-medium"},kl={class:"font-semibold text-primary"},Cl={class:"mt-4 flex justify-content-end"},Nl={class:"bg-gray-50 p-3 border-round"},Il={class:"grid text-right"},Sl={class:"col-6 font-semibold"},Ul={class:"col-6 font-bold text-lg text-primary"},Rl={key:0,class:"mt-3"},Al={class:"flex justify-content-end gap-2"},Ql={__name:"PurchaseReceiving",props:{visible:{type:Boolean,default:!1},purchaseOrder:{type:Object,default:null}},emits:["update:visible","items-received"],setup(V,{emit:j}){const g=V,F=j,T=me(),E=y(!1),P=y(!1),p=y([]),D=y({receivedDate:new Date,invoiceNumber:"",notes:""}),C=M(()=>p.value.reduce((m,s)=>m+(s.receivingQuantity||0),0)),N=M(()=>p.value.reduce((m,s)=>m+(s.receivingQuantity||0)*s.unitPrice,0)),A=M(()=>p.value.some(m=>{const s=m.receivingQuantity||0;return s>0&&s!==m.pendingQuantity})),h=M(()=>{const m=D.value.receivedDate&&C.value>0,d=p.value.filter(i=>(i.receivingQuantity||0)>0).some(i=>{var z;return!((z=i.batchNumber)!=null&&z.trim())||i.expiryDate&&new Date(i.expiryDate)<=new Date});return m&&!d});ie(()=>g.visible,m=>{m&&g.purchaseOrder&&$()});const $=()=>{var m;(m=g.purchaseOrder)!=null&&m.items&&(p.value=g.purchaseOrder.items.filter(s=>(s.remainingQuantity||s.quantity)>0).map(s=>({...s,orderedQuantity:s.quantity,previouslyReceived:s.receivedQuantity||0,pendingQuantity:s.remainingQuantity||s.quantity,receivingQuantity:s.remainingQuantity||s.quantity,batchNumber:s.batchNumber||"",mfgDate:s.mfgDate?new Date(s.mfgDate):null,expiryDate:s.expiryDate?new Date(s.expiryDate):null,supplierBatchRef:s.supplierBatchRef||"",actualUnitCost:s.actualUnitCost||s.unitPrice,qualityStatus:s.qualityStatus||"pending"})),D.value={receivedDate:new Date,invoiceNumber:"",notes:""})},f=m=>{m.receivingQuantity>m.pendingQuantity&&(m.receivingQuantity=m.pendingQuantity,T.add({severity:"warn",summary:"Quantity Adjusted",detail:"Receiving quantity cannot exceed pending quantity",life:3e3}))},I=m=>{var d;const s=[];return(m.receivingQuantity||0)>0&&!((d=m.batchNumber)!=null&&d.trim())&&s.push("Batch number is required for pharmacy items"),m.expiryDate&&(m.mfgDate&&new Date(m.expiryDate)<=new Date(m.mfgDate)&&s.push("Expiry date must be after manufacturing date"),new Date(m.expiryDate)<=new Date&&s.push("Cannot receive expired items")),s.length>0?(T.add({severity:"error",summary:"Batch Validation Error",detail:s.join(". "),life:5e3}),!1):!0},R=async()=>{try{P.value=!0;const m=p.value.filter(i=>(i.receivingQuantity||0)>0);for(const i of m)if(!I(i)){P.value=!1;return}const s=p.value.filter(i=>(i.receivingQuantity||0)>0).map(i=>{var z,U;return{itemId:i.id,productId:i.productId,productName:i.productName,receivedQuantity:i.receivingQuantity,unitPrice:i.unitPrice,totalValue:i.receivingQuantity*i.unitPrice,batchNumber:i.batchNumber,mfgDate:(z=i.mfgDate)==null?void 0:z.toISOString().split("T")[0],expiryDate:(U=i.expiryDate)==null?void 0:U.toISOString().split("T")[0],supplierBatchRef:i.supplierBatchRef,actualUnitCost:i.actualUnitCost||i.unitPrice,discountAmount:i.discountAmount||0,taxAmount:i.taxAmount||0,qualityStatus:i.qualityStatus||"pending",qualityNotes:i.qualityNotes||""}}),d={poId:g.purchaseOrder.id,poNumber:g.purchaseOrder.poNumber,receivedDate:D.value.receivedDate.toISOString().split("T")[0],invoiceNumber:D.value.invoiceNumber,notes:D.value.notes,items:s,totalItems:C.value,totalValue:N.value,hasDiscrepancies:A.value};F("items-received",d),B(),T.add({severity:"success",summary:"Items Received",detail:`Successfully received ${C.value} items`,life:3e3})}catch{T.add({severity:"error",summary:"Receiving Failed",detail:"Failed to receive items",life:5e3})}finally{P.value=!1}},B=()=>{p.value=[],F("update:visible",!1)},W=m=>m?new Date(m).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):"",Q=m=>new Intl.NumberFormat("en-IN").format(m||0);return(m,s)=>{const d=he,i=pe,z=De,U=_e,H=Ve,x=we,u=We,Z=ve,O=fe;return S(),K(O,{visible:V.visible,modal:"",header:"Receive Purchase Order",style:{width:"90vw",maxWidth:"1000px"},breakpoints:{"960px":"95vw"},"onUpdate:visible":s[3]||(s[3]=b=>m.$emit("update:visible",b)),onHide:B},{footer:r(()=>[e("div",Al,[l(Z,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:B}),l(Z,{label:"Receive Items",icon:"pi pi-check",disabled:!h.value,loading:P.value,onClick:R},null,8,["disabled","loading"])])]),default:r(()=>[V.purchaseOrder?(S(),X("div",sl,[e("div",ol,[e("div",al,[e("div",il,[s[4]||(s[4]=e("div",{class:"text-sm text-600"},"Purchase Order",-1)),e("div",nl,n(V.purchaseOrder.poNumber),1)]),e("div",dl,[s[5]||(s[5]=e("div",{class:"text-sm text-600"},"Vendor",-1)),e("div",rl,n(V.purchaseOrder.vendorName),1)]),e("div",ul,[s[6]||(s[6]=e("div",{class:"text-sm text-600"},"Order Date",-1)),e("div",cl,n(W(V.purchaseOrder.orderDate)),1)]),e("div",ml,[s[7]||(s[7]=e("div",{class:"text-sm text-600"},"Expected Delivery",-1)),e("div",vl,n(W(V.purchaseOrder.expectedDelivery)),1)])])]),e("div",pl,[e("div",fl,[e("div",bl,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Received Date *",-1)),l(d,{modelValue:D.value.receivedDate,"onUpdate:modelValue":s[0]||(s[0]=b=>D.value.receivedDate=b),"max-date":new Date,placeholder:"Select received date",class:"w-full"},null,8,["modelValue","max-date"])])]),e("div",yl,[e("div",xl,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Invoice Number",-1)),l(i,{modelValue:D.value.invoiceNumber,"onUpdate:modelValue":s[1]||(s[1]=b=>D.value.invoiceNumber=b),placeholder:"Enter invoice number",class:"w-full"},null,8,["modelValue"])])]),e("div",gl,[e("div",hl,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Receiving Notes",-1)),l(z,{modelValue:D.value.notes,"onUpdate:modelValue":s[2]||(s[2]=b=>D.value.notes=b),placeholder:"Enter any notes about the shipment...",rows:"3",class:"w-full"},null,8,["modelValue"])])])]),e("div",_l,[s[16]||(s[16]=e("h3",{class:"text-lg font-semibold text-900 mb-3"},"Items to Receive",-1)),l(x,{value:p.value,loading:E.value,responsiveLayout:"scroll",class:"border-1 border-200"},{empty:r(()=>s[11]||(s[11]=[e("div",{class:"text-center py-4"},[e("i",{class:"pi pi-inbox text-4xl text-gray-300 mb-3"}),e("p",{class:"text-gray-500"},"No items to receive")],-1)])),default:r(()=>[l(U,{field:"productName",header:"Product",style:{"min-width":"200px"}},{body:r(({data:b})=>[e("div",wl,n(b.productName),1),e("div",Dl,"ID: "+n(b.productId),1)]),_:1}),l(U,{field:"orderedQuantity",header:"Ordered",style:{"min-width":"100px"}},{body:r(({data:b})=>[e("span",Vl,n(b.orderedQuantity),1)]),_:1}),l(U,{field:"previouslyReceived",header:"Previously Received",style:{"min-width":"120px"}},{body:r(({data:b})=>[e("span",$l,n(b.previouslyReceived||0),1)]),_:1}),l(U,{field:"pendingQuantity",header:"Pending",style:{"min-width":"100px"}},{body:r(({data:b})=>[e("span",Pl,n(b.pendingQuantity),1)]),_:1}),l(U,{field:"receivingQuantity",header:"Receiving Now *",style:{"min-width":"150px"}},{body:r(({data:b})=>[l(H,{modelValue:b.receivingQuantity,"onUpdate:modelValue":G=>b.receivingQuantity=G,min:0,max:b.pendingQuantity,class:"w-full",onInput:G=>f(b)},null,8,["modelValue","onUpdate:modelValue","max","onInput"])]),_:1}),l(U,{field:"unitPrice",header:"Unit Price",style:{"min-width":"120px"}},{body:r(({data:b})=>[e("span",Ol,"â‚¹"+n(Q(b.unitPrice)),1)]),_:1}),l(U,{field:"batchNumber",header:"Batch #",style:{"min-width":"150px"}},{body:r(({data:b})=>[l(i,{modelValue:b.batchNumber,"onUpdate:modelValue":G=>b.batchNumber=G,placeholder:"Enter batch number",class:"w-full",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(U,{field:"expiryDate",header:"Expiry Date",style:{"min-width":"150px"}},{body:r(({data:b})=>[l(d,{modelValue:b.expiryDate,"onUpdate:modelValue":G=>b.expiryDate=G,placeholder:"Select expiry",class:"w-full",size:"small","min-date":new Date},null,8,["modelValue","onUpdate:modelValue","min-date"])]),_:1}),l(U,{field:"receivingValue",header:"Receiving Value",style:{"min-width":"120px"}},{body:r(({data:b})=>[e("span",kl," â‚¹"+n(Q((b.receivingQuantity||0)*b.unitPrice)),1)]),_:1})]),_:1},8,["value","loading"]),e("div",Cl,[e("div",Nl,[e("div",Il,[s[12]||(s[12]=e("div",{class:"col-6 text-600"},"Total Items Receiving:",-1)),e("div",Sl,n(C.value),1),s[13]||(s[13]=e("div",{class:"col-6 text-600"},"Total Value Receiving:",-1)),e("div",Ul,"â‚¹"+n(Q(N.value)),1)])])]),A.value?(S(),X("div",Rl,[l(u,{severity:"warn",closable:!1},{messageicon:r(()=>s[14]||(s[14]=[e("i",{class:"pi pi-exclamation-triangle"},null,-1)])),default:r(()=>[s[15]||(s[15]=Ee(" Some items have receiving quantities different from ordered quantities. Please verify and add notes explaining any discrepancies. "))]),_:1,__:[15]})])):le("",!0)])])):le("",!0)]),_:1},8,["visible"])}}},ql=ne(Ql,[["__scopeId","data-v-9e7ead85"]]),Tl={class:"purchase-management"},El={class:"flex flex-column md:flex-row justify-content-between align-items-start md:align-items-center mb-3 gap-3"},Bl={class:"flex flex-wrap gap-2"},Fl={class:"grid mb-4"},Ll={class:"col-12 md:col-3"},Ml={class:"p-inputgroup"},jl={class:"col-12 md:col-2"},zl={class:"col-12 md:col-2"},Hl={class:"col-12 md:col-2"},Gl={class:"po-number"},Wl={class:"font-bold text-900"},Yl={class:"text-xs text-600"},Jl={class:"vendor-info"},Kl={class:"font-semibold text-900"},Xl={class:"text-sm text-600"},Zl={class:"items-info"},es={class:"font-medium text-900"},ts={class:"text-sm text-600"},ls={class:"text-xs text-500"},ss={class:"amount-info text-right"},os={class:"font-bold text-900"},as={class:"delivery-info"},is={class:"font-medium text-900"},ns={class:"flex gap-1"},ds={class:"grid mb-4"},rs={class:"col-12 md:col-4"},us={class:"p-inputgroup"},cs={class:"col-12 md:col-2"},ms={class:"col-12 md:col-2"},vs={class:"grid"},ps={class:"vendor-header flex justify-content-between align-items-start mb-3"},fs={class:"text-lg font-bold text-900 m-0"},bs={class:"text-sm text-600 mt-1 mb-0"},ys={class:"vendor-details"},xs={class:"flex align-items-center mb-2"},gs={class:"text-sm text-900"},hs={class:"flex align-items-center mb-2"},_s={class:"text-sm text-900"},ws={class:"flex align-items-center mb-2"},Ds={class:"text-sm text-900"},Vs={class:"flex align-items-center mb-3"},$s={class:"text-sm text-900"},Ps={class:"vendor-stats grid"},Os={class:"col-6 text-center"},ks={class:"font-bold text-lg text-900"},Cs={class:"col-6 text-center"},Ns={class:"font-bold text-lg text-900"},Is={class:"vendor-actions flex gap-2 mt-3"},Ss={class:"grid p-fluid"},Us={class:"col-12 md:col-6"},Rs={class:"col-12 md:col-6"},As={class:"col-12"},Qs={class:"grid p-fluid"},qs={class:"col-12 md:col-6"},Ts={class:"col-12 md:col-6"},Es={class:"col-12 md:col-6"},Bs={class:"col-12 md:col-6"},Fs={class:"col-12"},Ls={class:"col-12"},Ms={class:"col-12 md:col-6"},js={class:"col-12 md:col-6"},zs={__name:"PurchaseManagement",emits:["po-created","po-updated","vendor-added","po-received"],setup(V,{emit:j}){const{usePurchase:g}=ge(),{fetchPurchaseOrders:F,fetchVendors:T,purchaseOrders:E}=g(),P=y([]),p=y(!1);Ne(async()=>{p.value=!0;try{await Promise.all([T(),F()])}finally{p.value=!1}});const D=j,C=y(""),N=y(""),A=y(null),h=y(null),$=y(null),f=y(null),I=y(null),R=y(!1),B=y(!1),W=y([{label:"Draft",value:"Draft"},{label:"Sent",value:"Sent"},{label:"Confirmed",value:"Confirmed"},{label:"Shipped",value:"Shipped"},{label:"Delivered",value:"Delivered"},{label:"Cancelled",value:"Cancelled"}]),Q=y([{label:"Active",value:"Active"},{label:"Inactive",value:"Inactive"},{label:"Blocked",value:"Blocked"}]),m=y([{label:"Pharmaceutical",value:"pharmaceutical"},{label:"Medical Equipment",value:"medical-equipment"},{label:"Surgical Supplies",value:"surgical-supplies"},{label:"Laboratory",value:"laboratory"},{label:"General Supplies",value:"general-supplies"}]),s=y({vendorId:null,expectedDelivery:null,notes:""}),d=y({name:"",category:null,contactPerson:"",phone:"",email:"",address:"",city:"",state:""}),i=M(()=>{let a=[...E.value];if(C.value){const t=C.value.toLowerCase();a=a.filter(c=>c.poNumber.toLowerCase().includes(t)||c.vendorName.toLowerCase().includes(t)||c.itemsSummary.toLowerCase().includes(t))}if(A.value&&(a=a.filter(t=>t.status===A.value)),h.value&&(a=a.filter(t=>t.vendorId===h.value)),I.value&&I.value.length===2){const[t,c]=I.value;a=a.filter(_=>{const w=new Date(_.createdAt);return w>=t&&w<=c})}return a.sort((t,c)=>new Date(c.createdAt)-new Date(t.createdAt))}),z=M(()=>{let a=[...P.value];if(N.value){const t=N.value.toLowerCase();a=a.filter(c=>c.name.toLowerCase().includes(t)||c.contactPerson.toLowerCase().includes(t)||c.city.toLowerCase().includes(t))}return $.value&&(a=a.filter(t=>t.status===$.value)),f.value&&(a=a.filter(t=>t.category===f.value)),a.sort((t,c)=>c.totalValue-t.totalValue)});M(()=>{const a=E.value,t=P.value.filter(k=>k.status==="Active").length,c=new Date,_=new Date(c.getFullYear(),c.getMonth(),1),w=a.filter(k=>new Date(k.orderDate||k.createdAt).toDateString()===c.toDateString()).length,q=a.filter(k=>new Date(k.orderDate||k.createdAt)>=_).reduce((k,ee)=>k+(ee.totalAmount||0),0),J=a.filter(k=>["Draft","Sent","Confirmed","Shipped","pending"].includes(k.status)).length,re=a.filter(k=>["Sent","Confirmed","Shipped","pending"].includes(k.status)?new Date(k.expectedDelivery)<c:!1).length,xe=P.value.filter(k=>k.rating>=4).length,ue=P.value.length>0?Math.round(P.value.reduce((k,ee)=>k+(ee.rating||0),0)/P.value.length*20):0;return{totalOrders:a.length,todayOrders:w,totalValue:a.reduce((k,ee)=>k+(ee.totalAmount||0),0),monthlyValue:q,pendingOrders:J,overdueOrders:re,activeVendors:t,topVendors:xe,vendorPerformance:ue}});const U=a=>new Intl.NumberFormat("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a),H=a=>new Date(a).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}),x=a=>{switch(a){case"Draft":return"secondary";case"Sent":return"info";case"Confirmed":return"warning";case"Shipped":return"primary";case"Delivered":return"success";case"Cancelled":return"danger";default:return"secondary"}},u=a=>{switch(a){case"Active":return"success";case"Inactive":return"warning";case"Blocked":return"danger";default:return"secondary"}},Z=a=>{const t=new Date,c=new Date(a),_=Math.ceil((c-t)/(1e3*60*60*24));return _<0?"Overdue":_===0?"Today":_===1?"Tomorrow":_<=7?`${_} days`:"On time"},O=a=>{const t=new Date,c=new Date(a),_=Math.ceil((c-t)/(1e3*60*60*24));return _<0?"text-red-600":_<=1?"text-orange-600":_<=3?"text-blue-600":"text-green-600"},b=y(!1),G=y(!1),L=y(null),Y=y("view"),de=a=>{L.value={...a},Y.value="view",b.value=!0},be=a=>{L.value={...a},Y.value="edit",b.value=!0},ye=a=>{L.value={...a},G.value=!0},oe=a=>{console.log("Printing PO:",a.poNumber);const t=window.open("","_blank"),c=qe(a);t.document.write(c),t.document.close(),t.print()},v=a=>{console.log("Viewing vendor details:",a)},te=a=>{s.value.vendorId=a.id,R.value=!0},$e=()=>{if(!s.value.vendorId||!s.value.expectedDelivery){console.error("Please fill all required fields");return}const a=P.value.find(c=>c.id===s.value.vendorId),t={id:E.value.length+1,poNumber:`PO-2024-${String(E.value.length+1).padStart(3,"0")}`,vendorId:s.value.vendorId,vendorName:a.name,vendorContact:a.phone,totalItems:0,totalQuantity:0,itemsSummary:"Items to be added...",totalAmount:0,status:"Draft",expectedDelivery:s.value.expectedDelivery.toISOString().split("T")[0],createdAt:new Date().toISOString()};E.value.unshift(t),D("po-created",t),console.log("Purchase order created:",t.poNumber),s.value={vendorId:null,expectedDelivery:null,notes:""},R.value=!1},Se=()=>{if(!d.value.name||!d.value.contactPerson||!d.value.phone){console.error("Please fill all required fields");return}const a={id:P.value.length+1,...d.value,status:"Active",totalOrders:0,totalValue:0,rating:0};P.value.push(a),D("vendor-added",a),console.log("Vendor added:",a.name),d.value={name:"",category:null,contactPerson:"",phone:"",email:"",address:"",city:"",state:""},B.value=!1},Ue=()=>{console.log("Generating purchase report...")},Re=a=>{const t=E.value.findIndex(c=>c.id===a.id);t!==-1&&(E.value[t]=a,D("po-updated",a)),b.value=!1},Ae=a=>{oe(a)},Qe=a=>{const t=E.value.find(c=>c.id===a.poId);if(t&&t.items){a.items.forEach(w=>{const q=t.items.find(J=>J.id===w.itemId);q&&(q.receivedQuantity=(q.receivedQuantity||0)+w.receivedQuantity,q.remainingQuantity=q.quantity-q.receivedQuantity,w.batchNumber&&(q.batchNumber=w.batchNumber),w.mfgDate&&(q.mfgDate=w.mfgDate),w.expiryDate&&(q.expiryDate=w.expiryDate),w.supplierBatchRef&&(q.supplierBatchRef=w.supplierBatchRef),w.actualUnitCost&&(q.actualUnitCost=w.actualUnitCost),w.qualityStatus&&(q.qualityStatus=w.qualityStatus))});const c=t.items.every(w=>w.remainingQuantity<=0),_=t.items.some(w=>(w.receivedQuantity||0)>0);c?t.status="completed":_&&(t.status="partial"),t.updatedAt=new Date().toISOString(),D("po-received",{po:t,receivingData:a})}G.value=!1},qe=a=>{var c;const t=P.value.find(_=>_.id===a.vendorId);return`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Purchase Order - ${a.poNumber}</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .po-info { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .vendor-info { margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .total { text-align: right; font-weight: bold; }
        @media print { body { margin: 0; } }
      </style>
    </head>
    <body>
      <div class="header">
        <h1>PURCHASE ORDER</h1>
        <h2>${a.poNumber}</h2>
      </div>

      <div class="po-info">
        <div>
          <strong>Order Date:</strong> ${new Date(a.orderDate).toLocaleDateString()}<br>
          <strong>Expected Delivery:</strong> ${new Date(a.expectedDelivery).toLocaleDateString()}
        </div>
        <div>
          <strong>Status:</strong> ${a.status.toUpperCase()}
        </div>
      </div>

      <div class="vendor-info">
        <h3>Vendor Information</h3>
        <strong>${(t==null?void 0:t.name)||a.vendorName}</strong><br>
        ${(t==null?void 0:t.address)||""}<br>
        Phone: ${(t==null?void 0:t.phone)||a.vendorContact}<br>
        Email: ${(t==null?void 0:t.email)||""}
      </div>

      <table>
        <thead>
          <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          ${((c=a.items)==null?void 0:c.map(_=>`
            <tr>
              <td>${_.productName}</td>
              <td>${_.quantity}</td>
              <td>â‚¹${_.unitPrice.toLocaleString("en-IN")}</td>
              <td>â‚¹${_.totalPrice.toLocaleString("en-IN")}</td>
            </tr>
          `).join(""))||'<tr><td colspan="4">No items</td></tr>'}
        </tbody>
      </table>

      <div class="total">
        <strong>Total Amount: â‚¹${(a.totalAmount||0).toLocaleString("en-IN")}</strong>
      </div>

      ${a.notes?`<div><strong>Notes:</strong> ${a.notes}</div>`:""}
    </body>
    </html>
  `};return(a,t)=>{const c=ve,_=pe,w=Ie,q=he,J=_e,re=Me,xe=we,ue=ke,k=je,ee=ze,Pe=De,Oe=fe,ce=Ce("tooltip");return S(),X("div",Tl,[e("div",El,[t[26]||(t[26]=e("div",null,[e("h2",{class:"text-xl font-bold text-900 m-0"},"Purchase Management"),e("p",{class:"text-600 text-sm mt-1 mb-0"},"Manage vendors, purchase orders, and procurement")],-1)),e("div",Bl,[l(c,{label:"New Purchase Order",icon:"pi pi-plus",severity:"primary",size:"small",onClick:t[0]||(t[0]=o=>R.value=!0)}),l(c,{label:"Add Vendor",icon:"pi pi-user-plus",severity:"secondary",outlined:"",size:"small",onClick:t[1]||(t[1]=o=>B.value=!0)}),l(c,{label:"Generate Report",icon:"pi pi-file-pdf",severity:"info",outlined:"",size:"small",onClick:Ue})])]),l(ee,null,{default:r(()=>[l(k,{header:"Purchase Orders"},{default:r(()=>[e("div",Fl,[e("div",Ll,[e("div",Ml,[t[27]||(t[27]=e("span",{class:"p-inputgroup-addon"},[e("i",{class:"pi pi-search"})],-1)),l(_,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=o=>C.value=o),placeholder:"Search orders...",class:"w-full"},null,8,["modelValue"])])]),e("div",jl,[l(w,{modelValue:A.value,"onUpdate:modelValue":t[3]||(t[3]=o=>A.value=o),options:W.value,"option-label":"label","option-value":"value",placeholder:"Status",class:"w-full","show-clear":""},null,8,["modelValue","options"])]),e("div",zl,[l(w,{modelValue:h.value,"onUpdate:modelValue":t[4]||(t[4]=o=>h.value=o),options:P.value,"option-label":"name","option-value":"id",placeholder:"Vendor",class:"w-full","show-clear":""},null,8,["modelValue","options"])]),e("div",Hl,[l(q,{modelValue:I.value,"onUpdate:modelValue":t[5]||(t[5]=o=>I.value=o),"selection-mode":"range","manual-input":!1,placeholder:"Date Range",class:"w-full","show-clear":""},null,8,["modelValue"])])]),l(ue,null,{content:r(()=>[l(xe,{value:i.value,paginator:!0,rows:15,loading:p.value,"paginator-template":"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown","rows-per-page-options":[10,15,25],"current-page-report-template":"Showing {first} to {last} of {totalRecords} orders","responsive-layout":"scroll","striped-rows":"",class:"purchase-orders-table"},{default:r(()=>[l(J,{field:"poNumber",header:"PO Number",sortable:!0,style:{"min-width":"120px"}},{body:r(({data:o})=>[e("div",Gl,[e("div",Wl,n(o.poNumber),1),e("div",Yl,n(H(o.createdAt)),1)])]),_:1}),l(J,{field:"vendorName",header:"Vendor",sortable:!0,style:{"min-width":"150px"}},{body:r(({data:o})=>[e("div",Jl,[e("div",Kl,n(o.vendorName),1),e("div",Xl,n(o.vendorContact),1)])]),_:1}),l(J,{header:"Items",sortable:!1,style:{"min-width":"200px"}},{body:r(({data:o})=>[e("div",Zl,[e("div",es,n(o.totalItems)+" items",1),e("div",ts,n(o.totalQuantity)+" units",1),e("div",ls,n(o.itemsSummary),1)])]),_:1}),l(J,{field:"totalAmount",header:"Amount",sortable:!0,style:{"min-width":"120px"}},{body:r(({data:o})=>[e("div",ss,[e("div",os,"â‚¹"+n(U(o.totalAmount)),1),t[28]||(t[28]=e("div",{class:"text-xs text-600"},"Inc. GST",-1))])]),_:1}),l(J,{field:"status",header:"Status",sortable:!0,style:{"min-width":"100px"}},{body:r(({data:o})=>[l(re,{value:o.status,severity:x(o.status),class:"font-medium"},null,8,["value","severity"])]),_:1}),l(J,{field:"expectedDelivery",header:"Expected Delivery",sortable:!0,style:{"min-width":"120px"}},{body:r(({data:o})=>[e("div",as,[e("div",is,n(H(o.expectedDelivery)),1),e("div",{class:Be(["text-xs",O(o.expectedDelivery)])},n(Z(o.expectedDelivery)),3)])]),_:1}),l(J,{header:"Actions",style:{"min-width":"150px"}},{body:r(({data:o})=>[e("div",ns,[se(l(c,{icon:"pi pi-eye",size:"small",text:"",rounded:"",severity:"info",onClick:ae=>de(o)},null,8,["onClick"]),[[ce,"View Details",void 0,{top:!0}]]),se(l(c,{icon:"pi pi-pencil",size:"small",text:"",rounded:"",severity:"secondary",onClick:ae=>be(o),disabled:o.status==="Delivered"||o.status==="Cancelled"},null,8,["onClick","disabled"]),[[ce,"Edit Order",void 0,{top:!0}]]),se(l(c,{icon:"pi pi-download",size:"small",text:"",rounded:"",severity:"success",onClick:ae=>ye(o),disabled:o.status==="completed"||o.status==="cancelled"},null,8,["onClick","disabled"]),[[ce,"Receive Items",void 0,{top:!0}]]),se(l(c,{icon:"pi pi-print",size:"small",text:"",rounded:"",severity:"info",onClick:ae=>oe(o)},null,8,["onClick"]),[[ce,"Print PO",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])]),_:1})]),_:1}),l(k,{header:"Vendors"},{default:r(()=>[e("div",ds,[e("div",rs,[e("div",us,[t[29]||(t[29]=e("span",{class:"p-inputgroup-addon"},[e("i",{class:"pi pi-search"})],-1)),l(_,{modelValue:N.value,"onUpdate:modelValue":t[6]||(t[6]=o=>N.value=o),placeholder:"Search vendors...",class:"w-full"},null,8,["modelValue"])])]),e("div",cs,[l(w,{modelValue:$.value,"onUpdate:modelValue":t[7]||(t[7]=o=>$.value=o),options:Q.value,"option-label":"label","option-value":"value",placeholder:"Status",class:"w-full","show-clear":""},null,8,["modelValue","options"])]),e("div",ms,[l(w,{modelValue:f.value,"onUpdate:modelValue":t[8]||(t[8]=o=>f.value=o),options:m.value,"option-label":"label","option-value":"value",placeholder:"Category",class:"w-full","show-clear":""},null,8,["modelValue","options"])])]),e("div",vs,[(S(!0),X(Fe,null,Le(z.value,o=>(S(),X("div",{key:o.id,class:"col-12 md:col-6 lg:col-4"},[l(ue,{class:"vendor-card"},{content:r(()=>[e("div",ps,[e("div",null,[e("h4",fs,n(o.name),1),e("p",bs,n(o.category),1)]),l(re,{value:o.status,severity:u(o.status),class:"font-medium"},null,8,["value","severity"])]),e("div",ys,[e("div",xs,[t[30]||(t[30]=e("i",{class:"pi pi-user text-600 mr-2"},null,-1)),e("span",gs,n(o.contactPerson),1)]),e("div",hs,[t[31]||(t[31]=e("i",{class:"pi pi-phone text-600 mr-2"},null,-1)),e("span",_s,n(o.phone),1)]),e("div",ws,[t[32]||(t[32]=e("i",{class:"pi pi-envelope text-600 mr-2"},null,-1)),e("span",Ds,n(o.email),1)]),e("div",Vs,[t[33]||(t[33]=e("i",{class:"pi pi-map-marker text-600 mr-2"},null,-1)),e("span",$s,n(o.city)+", "+n(o.state),1)])]),e("div",Ps,[e("div",Os,[e("div",ks,n(o.totalOrders),1),t[34]||(t[34]=e("div",{class:"text-xs text-600"},"Orders",-1))]),e("div",Cs,[e("div",Ns,"â‚¹"+n(U(o.totalValue)),1),t[35]||(t[35]=e("div",{class:"text-xs text-600"},"Total Value",-1))])]),e("div",Is,[l(c,{label:"View Details",icon:"pi pi-eye",size:"small",text:"",class:"flex-1",onClick:ae=>v(o)},null,8,["onClick"]),l(c,{label:"New PO",icon:"pi pi-plus",size:"small",outlined:"",class:"flex-1",onClick:ae=>te(o)},null,8,["onClick"])])]),_:2},1024)]))),128))])]),_:1})]),_:1}),l(Oe,{visible:R.value,"onUpdate:visible":t[13]||(t[13]=o=>R.value=o),modal:"",header:"Create New Purchase Order",style:{width:"800px"},breakpoints:{"960px":"75vw","641px":"90vw"}},{footer:r(()=>[l(c,{label:"Cancel",icon:"pi pi-times",text:"",onClick:t[12]||(t[12]=o=>R.value=!1)}),l(c,{label:"Create Order",icon:"pi pi-check",onClick:$e})]),default:r(()=>[e("div",Ss,[e("div",Us,[t[36]||(t[36]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Vendor *",-1)),l(w,{modelValue:s.value.vendorId,"onUpdate:modelValue":t[9]||(t[9]=o=>s.value.vendorId=o),options:P.value,"option-label":"name","option-value":"id",placeholder:"Select Vendor",class:"w-full"},null,8,["modelValue","options"])]),e("div",Rs,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Expected Delivery *",-1)),l(q,{modelValue:s.value.expectedDelivery,"onUpdate:modelValue":t[10]||(t[10]=o=>s.value.expectedDelivery=o),"min-date":new Date,placeholder:"Select Date",class:"w-full"},null,8,["modelValue","min-date"])]),e("div",As,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Notes",-1)),l(Pe,{modelValue:s.value.notes,"onUpdate:modelValue":t[11]||(t[11]=o=>s.value.notes=o),rows:"3",placeholder:"Additional notes or instructions...",class:"w-full"},null,8,["modelValue"])])])]),_:1},8,["visible"]),l(Oe,{visible:B.value,"onUpdate:visible":t[23]||(t[23]=o=>B.value=o),modal:"",header:"Add New Vendor",style:{width:"600px"},breakpoints:{"960px":"75vw","641px":"90vw"}},{footer:r(()=>[l(c,{label:"Cancel",icon:"pi pi-times",text:"",onClick:t[22]||(t[22]=o=>B.value=!1)}),l(c,{label:"Add Vendor",icon:"pi pi-check",onClick:Se})]),default:r(()=>[e("div",Qs,[e("div",qs,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Vendor Name *",-1)),l(_,{modelValue:d.value.name,"onUpdate:modelValue":t[14]||(t[14]=o=>d.value.name=o),placeholder:"Enter vendor name"},null,8,["modelValue"])]),e("div",Ts,[t[40]||(t[40]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Category *",-1)),l(w,{modelValue:d.value.category,"onUpdate:modelValue":t[15]||(t[15]=o=>d.value.category=o),options:m.value,"option-label":"label","option-value":"value",placeholder:"Select Category",class:"w-full"},null,8,["modelValue","options"])]),e("div",Es,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Contact Person *",-1)),l(_,{modelValue:d.value.contactPerson,"onUpdate:modelValue":t[16]||(t[16]=o=>d.value.contactPerson=o),placeholder:"Contact person name"},null,8,["modelValue"])]),e("div",Bs,[t[42]||(t[42]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Phone *",-1)),l(_,{modelValue:d.value.phone,"onUpdate:modelValue":t[17]||(t[17]=o=>d.value.phone=o),placeholder:"Phone number"},null,8,["modelValue"])]),e("div",Fs,[t[43]||(t[43]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Email",-1)),l(_,{modelValue:d.value.email,"onUpdate:modelValue":t[18]||(t[18]=o=>d.value.email=o),placeholder:"Email address"},null,8,["modelValue"])]),e("div",Ls,[t[44]||(t[44]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"Address",-1)),l(Pe,{modelValue:d.value.address,"onUpdate:modelValue":t[19]||(t[19]=o=>d.value.address=o),rows:"2",placeholder:"Complete address"},null,8,["modelValue"])]),e("div",Ms,[t[45]||(t[45]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"City",-1)),l(_,{modelValue:d.value.city,"onUpdate:modelValue":t[20]||(t[20]=o=>d.value.city=o),placeholder:"City"},null,8,["modelValue"])]),e("div",js,[t[46]||(t[46]=e("label",{class:"block text-sm font-medium text-900 mb-2"},"State",-1)),l(_,{modelValue:d.value.state,"onUpdate:modelValue":t[21]||(t[21]=o=>d.value.state=o),placeholder:"State"},null,8,["modelValue"])])])]),_:1},8,["visible"]),l(ll,{visible:b.value,"onUpdate:visible":t[24]||(t[24]=o=>b.value=o),"purchase-order":L.value,vendors:P.value,mode:Y.value,onSave:Re,onPrint:Ae},null,8,["visible","purchase-order","vendors","mode"]),l(ql,{visible:G.value,"onUpdate:visible":t[25]||(t[25]=o=>G.value=o),"purchase-order":L.value,onItemsReceived:Qe},null,8,["visible","purchase-order"])])}}},Hs=ne(zs,[["__scopeId","data-v-e35f3e9f"]]),Gs={class:"purchase-page"},Ws={class:"grid mb-4"},Ys={class:"col-12 md:col-3"},Js={class:"flex align-items-center"},Ks={class:"text-2xl font-bold text-900"},Xs={class:"col-12 md:col-3"},Zs={class:"flex align-items-center"},eo={class:"text-2xl font-bold text-900"},to={class:"col-12 md:col-3"},lo={class:"flex align-items-center"},so={class:"text-2xl font-bold text-900"},oo={class:"col-12 md:col-3"},ao={class:"flex align-items-center"},io={class:"text-2xl font-bold text-900"},no={__name:"index",setup(V){const j=me(),{usePurchase:g}=ge(),{purchaseOrders:F,vendors:T,fetchPurchaseOrders:E,fetchVendors:P}=g();y(0);const p=M(()=>{var $,f,I,R,B,W;return{totalPOs:(($=F.value)==null?void 0:$.length)||0,totalValue:((f=F.value)==null?void 0:f.reduce((Q,m)=>Q+m.totalAmount,0))||0,pendingPOs:((R=(I=F.value)==null?void 0:I.filter(Q=>Q.status==="pending"||Q.status==="confirmed"))==null?void 0:R.length)||0,activeVendors:((W=(B=T.value)==null?void 0:B.filter(Q=>Q.isActive))==null?void 0:W.length)||0}});Ne(async()=>{try{await Promise.all([E(),P()])}catch($){console.error("Failed to load purchase data:",$),j.add({severity:"error",summary:"Error",detail:"Failed to load purchase data",life:3e3})}});const D=$=>new Intl.NumberFormat("en-IN",{minimumFractionDigits:0,maximumFractionDigits:0}).format($),C=$=>{j.add({severity:"success",summary:"Success",detail:`Purchase Order ${$.poNumber} created successfully`,life:3e3})},N=$=>{j.add({severity:"info",summary:"Updated",detail:`Purchase Order ${$.poNumber} updated`,life:3e3})},A=$=>{j.add({severity:"success",summary:"Success",detail:`Vendor ${$.name} added successfully`,life:3e3})},h=$=>{j.add({severity:"success",summary:"Received",detail:`Purchase Order ${$.poNumber} marked as received`,life:3e3})};return($,f)=>{const I=ke,R=Te;return S(),X("div",Gs,[e("div",Ws,[e("div",Ys,[l(I,{class:"kpi-card"},{content:r(()=>[e("div",Js,[f[2]||(f[2]=e("div",{class:"kpi-icon bg-blue-100 text-blue-600 mr-3"},[e("i",{class:"pi pi-shopping-cart text-xl"})],-1)),e("div",null,[e("div",Ks,n(p.value.totalPOs),1),f[0]||(f[0]=e("div",{class:"text-sm text-600"},"Total POs",-1)),f[1]||(f[1]=e("div",{class:"text-xs text-500 mt-1"},"This Month",-1))])])]),_:1})]),e("div",Xs,[l(I,{class:"kpi-card"},{content:r(()=>[e("div",Zs,[f[5]||(f[5]=e("div",{class:"kpi-icon bg-green-100 text-green-600 mr-3"},[e("i",{class:"pi pi-money-bill text-xl"})],-1)),e("div",null,[e("div",eo,"â‚¹"+n(D(p.value.totalValue)),1),f[3]||(f[3]=e("div",{class:"text-sm text-600"},"Total Value",-1)),f[4]||(f[4]=e("div",{class:"text-xs text-500 mt-1"},"This Month",-1))])])]),_:1})]),e("div",to,[l(I,{class:"kpi-card"},{content:r(()=>[e("div",lo,[f[8]||(f[8]=e("div",{class:"kpi-icon bg-orange-100 text-orange-600 mr-3"},[e("i",{class:"pi pi-clock text-xl"})],-1)),e("div",null,[e("div",so,n(p.value.pendingPOs),1),f[6]||(f[6]=e("div",{class:"text-sm text-600"},"Pending",-1)),f[7]||(f[7]=e("div",{class:"text-xs text-500 mt-1"},"Awaiting Delivery",-1))])])]),_:1})]),e("div",oo,[l(I,{class:"kpi-card"},{content:r(()=>[e("div",ao,[f[11]||(f[11]=e("div",{class:"kpi-icon bg-purple-100 text-purple-600 mr-3"},[e("i",{class:"pi pi-users text-xl"})],-1)),e("div",null,[e("div",io,n(p.value.activeVendors),1),f[9]||(f[9]=e("div",{class:"text-sm text-600"},"Active Vendors",-1)),f[10]||(f[10]=e("div",{class:"text-xs text-500 mt-1"},"Verified Partners",-1))])])]),_:1})])]),l(Hs,{onPoCreated:C,onPoUpdated:N,onVendorAdded:A,onPoReceived:h}),l(R)])}}},ea=ne(no,[["__scopeId","data-v-2e66430e"]]);export{ea as default};
